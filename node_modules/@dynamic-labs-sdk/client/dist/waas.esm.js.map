{"version":3,"file":"waas.esm.js","names":["requirement: WalletCreationRequirement","packageName","packageVersion"],"sources":["../src/errors/NotWaasWalletProviderError.ts","../src/modules/waas/getWaasWalletProviderFromWalletAccount/getWaasWalletProviderFromWalletAccount.ts","../src/modules/waas/backupWaasKeySharesToGoogleDrive/backupWaasKeySharesToGoogleDrive.ts","../src/modules/waas/isWalletCreationRequirement/isWalletCreationRequirement.ts","../src/modules/waas/normalizeWalletRequirements/normalizeWalletRequirements.ts","../src/modules/waas/createWaasWalletAccounts/createWaasWalletAccounts.ts","../src/modules/waas/delegateWaasKeyShares/delegateWaasKeyShares.ts","../src/modules/waas/exportWaasClientKeyshares/exportWaasClientKeyshares.ts","../src/modules/waas/exportWaasPrivateKey/exportWaasPrivateKey.ts","../src/modules/wallets/userHasEmbeddedWalletForChain/userHasEmbeddedWalletForChain.ts","../src/modules/waas/isDynamicWaasEnabled/isDynamicWaasEnabled.ts","../src/modules/waas/getChainsMissingWaasWalletAccounts/getChainsMissingWaasWalletAccounts.ts","../src/modules/waas/hasDelegatedAccess/hasDelegatedAccess.ts","../src/modules/waas/getWaasWalletProviderByChain/getWaasWalletProviderByChain.ts","../src/modules/waas/importWaasPrivateKey/importWaasPrivateKey.ts","../src/modules/waas/isPasswordRequiredForWaasWallets/isPasswordRequiredForWaasWallets.ts","../src/modules/waas/refreshWaasWalletAccountShares/refreshWaasWalletAccountShares.ts","../src/modules/waas/revokeWaasDelegation/revokeWaasDelegation.ts","../src/modules/wallets/userHasExternalWallet/userHasExternalWallet.ts","../src/modules/waas/shouldAutoCreateWalletForChain/shouldAutoCreateWalletForChain.ts","../src/modules/waas/updateWaasPassword/updateWaasPassword.ts","../src/exports/waas.ts"],"sourcesContent":["import { BaseError } from './base';\n\ntype NotWaasWalletProviderErrorParams = {\n  walletProviderKey: string;\n};\n\nexport class NotWaasWalletProviderError extends BaseError {\n  constructor({ walletProviderKey }: NotWaasWalletProviderErrorParams) {\n    super({\n      cause: null,\n      code: 'not_waas_wallet_provider_error',\n      docsUrl: null,\n      name: 'NotWaasWalletProviderError',\n      shortMessage: `Wallet provider ${walletProviderKey} is not a Dynamic WaaS wallet provider`,\n    });\n  }\n}\n","import type { DynamicClient } from '../../../client/types/DynamicClient';\nimport { NotWaasWalletAccountError } from '../../../errors/NotWaasWalletAccountError';\nimport { getWalletProviderFromWalletAccount } from '../../wallets/utils/getWalletProviderFromWalletAccount';\nimport type { WalletAccount } from '../../wallets/walletAccount';\nimport { isWaasWalletProvider } from '../isWaasWalletProvider';\nimport type { WaasWalletProvider } from '../waas.types';\n\ntype GetWalletProviderFromWalletAccountParams = {\n  walletAccount: WalletAccount;\n};\n\nexport const getWaasWalletProviderFromWalletAccount = (\n  { walletAccount }: GetWalletProviderFromWalletAccountParams,\n  client: DynamicClient\n): WaasWalletProvider => {\n  const walletProvider = getWalletProviderFromWalletAccount(\n    { walletAccount },\n    client\n  );\n\n  if (!isWaasWalletProvider(walletProvider)) {\n    throw new NotWaasWalletAccountError({\n      walletAddress: walletAccount.address,\n    });\n  }\n\n  return walletProvider;\n};\n","import { getDefaultClient } from '../../../client/defaultClient';\nimport type { WalletAccount } from '../../wallets/walletAccount';\nimport { getWaasWalletProviderFromWalletAccount } from '../getWaasWalletProviderFromWalletAccount';\n\ntype BackupWaasKeySharesToGoogleDriveParams = {\n  password?: string;\n  walletAccount: WalletAccount;\n};\n\n/**\n * Backs up WaaS wallet key shares to Google Drive for secure recovery.\n *\n * This function creates a backup of the wallet's cryptographic key shares\n * to Google Drive, allowing users to recover their wallet later.\n *\n * @param params.walletAccount - The WaaS wallet account to backup.\n * @param [params.password] - Optional password to encrypt the backup.\n * @param [client] - The Dynamic client instance. Only required when using multiple Dynamic clients.\n * @returns A promise that resolves when the backup process is complete.\n */\nexport const backupWaasKeySharesToGoogleDrive = async (\n  { password, walletAccount }: BackupWaasKeySharesToGoogleDriveParams,\n  client = getDefaultClient()\n) => {\n  const provider = getWaasWalletProviderFromWalletAccount(\n    { walletAccount },\n    client\n  );\n\n  return provider.backupKeySharesToGoogleDrive({\n    password,\n    walletAccount,\n  });\n};\n","import type { Chain } from '../../chain';\nimport type { WalletCreationRequirement } from '../waas.types';\n\n/**\n * Type guard to check if an item is a WalletCreationRequirement object.\n * Chain values are strings, so we can distinguish by checking if it's an object with a 'chain' property.\n *\n * @param item - The item to check, either a WalletCreationRequirement or Chain string\n * @returns True if the item is a WalletCreationRequirement object\n */\nexport const isWalletCreationRequirement = (\n  item: WalletCreationRequirement | Chain\n): item is WalletCreationRequirement =>\n  typeof item === 'object' && item !== null && 'chain' in item;\n","import type { Chain } from '../../chain';\nimport { isWalletCreationRequirement } from '../isWalletCreationRequirement/isWalletCreationRequirement';\nimport type {\n  WalletCreationBitcoinConfig,\n  WalletCreationRequirement,\n} from '../waas.types';\n\nconst DEFAULT_BITCOIN_ADDRESS_TYPE = 'native_segwit' as const;\n\ntype NormalizeWalletRequirementsParams = {\n  defaultBitcoinConfig?: WalletCreationBitcoinConfig;\n  input: WalletCreationRequirement[] | Chain[];\n};\n\n/**\n * Normalizes wallet creation input from either legacy Chain[] format\n * or new WalletCreationRequirement[] format to WalletCreationRequirement[].\n *\n * For BTC chains without explicit bitcoinConfig, defaults to native_segwit.\n *\n * @param params.input - Either an array of Chain strings or WalletCreationRequirement objects\n * @param params.defaultBitcoinConfig - Optional default bitcoin config to use for BTC chains when converting from legacy format\n * @returns Array of WalletCreationRequirement objects\n */\nexport const normalizeWalletRequirements = ({\n  defaultBitcoinConfig,\n  input,\n}: NormalizeWalletRequirementsParams): WalletCreationRequirement[] => {\n  if (input.length === 0) {\n    return [];\n  }\n\n  const [firstItem] = input;\n\n  if (isWalletCreationRequirement(firstItem)) {\n    return (input as WalletCreationRequirement[]).map((requirement) => {\n      if (requirement.chain === 'BTC' && !requirement.bitcoinConfig) {\n        return {\n          ...requirement,\n          bitcoinConfig: { addressType: DEFAULT_BITCOIN_ADDRESS_TYPE },\n        };\n      }\n\n      return requirement;\n    });\n  }\n\n  return (input as Chain[]).map((chain) => {\n    const requirement: WalletCreationRequirement = { chain };\n\n    if (chain === 'BTC') {\n      requirement.bitcoinConfig = defaultBitcoinConfig ?? {\n        addressType: DEFAULT_BITCOIN_ADDRESS_TYPE,\n      };\n    }\n\n    return requirement;\n  });\n};\n","import type { ThresholdSignatureScheme } from '@dynamic-labs-wallet/browser-wallet-client';\nimport { WalletProviderEnum } from '@dynamic-labs/sdk-api-core';\n\nimport { getDefaultClient } from '../../../client/defaultClient';\nimport { NotWaasWalletProviderError } from '../../../errors/NotWaasWalletProviderError';\nimport { NoWalletProviderFoundError } from '../../../errors/NoWalletProviderFoundError';\nimport type { Chain } from '../../chain';\nimport { refreshAuth } from '../../user/refreshAuth';\nimport { getWalletProviderByKey } from '../../wallets/getWalletProviderByKey';\nimport { formatWalletProviderKey } from '../../wallets/utils/formatWalletProviderKey';\nimport { DYNAMIC_WAAS_METADATA } from '../constants';\nimport { isWaasWalletProvider } from '../isWaasWalletProvider';\nimport { normalizeWalletRequirements } from '../normalizeWalletRequirements/normalizeWalletRequirements';\nimport type { WalletCreationRequirement } from '../waas.types';\n\ntype CreateWaasWalletAccountsParams = {\n  /**\n   * For which chains to create wallet accounts.\n   * Accepts either an array of chain strings (legacy format) or an array of\n   * WalletCreationRequirement objects for chain-specific configuration.\n   *\n   * For Bitcoin, you can specify the address type ('native_segwit' or 'taproot').\n   * If not specified, defaults to 'native_segwit'.\n   *\n   * If a chain is passed multiple times, just as many wallet accounts will be created\n   * for that chain.\n   */\n  chains: Chain[] | WalletCreationRequirement[];\n  /**\n   * The optional password to use for the wallet accounts.\n   * It's used to encrypt the user shares.\n   * The same password must be used for all waas wallet accounts created for the same user.\n   */\n  password?: string;\n  /**\n   * The threshold signature scheme to use for the wallet accounts.\n   * If not provided, TWO_OF_TWO will be used.\n   */\n  thresholdSignatureScheme?: ThresholdSignatureScheme;\n};\n\n/**\n * Creates wallet accounts for the specified chains.\n *\n * This function creates wallet accounts for the specified chains.\n * If the same chain is passed multiple times, just as many wallet accounts will be created\n * for that chain.\n *\n * @example\n * ```ts\n * // Legacy format - will create wallet accounts for EVM and SOL, BTC defaults to native_segwit\n * await createWaasWalletAccounts({ chains: ['EVM', 'SOL', 'BTC'] });\n *\n * // New format with chain-specific config\n * await createWaasWalletAccounts({\n *   chains: [\n *     { chain: 'BTC', bitcoinConfig: { addressType: 'taproot' } },\n *     { chain: 'EVM' },\n *   ]\n * });\n *\n * // Create both BTC address types\n * await createWaasWalletAccounts({\n *   chains: [\n *     { chain: 'BTC', bitcoinConfig: { addressType: 'native_segwit' } },\n *     { chain: 'BTC', bitcoinConfig: { addressType: 'taproot' } },\n *   ]\n * });\n * ```\n *\n * @param params.chains - The chains to create wallet accounts for.\n * @param params.password - The optional password to use for the wallet accounts.\n * @param params.thresholdSignatureScheme - The threshold signature scheme to use for the wallet accounts. (Default: TWO_OF_TWO)\n * @param [client] - The Dynamic client instance. Only required when using multiple Dynamic clients.\n * @returns A promise that resolves when all wallet accounts are created.\n */\nexport const createWaasWalletAccounts = async (\n  {\n    chains,\n    password,\n    thresholdSignatureScheme,\n  }: CreateWaasWalletAccountsParams,\n  client = getDefaultClient()\n): Promise<void> => {\n  const normalizedRequirements = normalizeWalletRequirements({ input: chains });\n\n  // we need this right now so we don't try to create wallet accounts for chains\n  // that we don't support Dynamic Waas yet in the JS SDK, like TRON\n  const supportedChains = ['BTC', 'EVM', 'SOL', 'SUI'];\n\n  const filteredRequirements = normalizedRequirements.filter((requirement) =>\n    supportedChains.includes(requirement.chain)\n  );\n\n  if (filteredRequirements.length === 0) {\n    return;\n  }\n\n  const walletProviderMap = new Map<\n    string,\n    ReturnType<typeof getWalletProviderByKey>\n  >();\n\n  for (const requirement of filteredRequirements) {\n    const walletProviderKey = formatWalletProviderKey({\n      chain: requirement.chain,\n      displayName: DYNAMIC_WAAS_METADATA.displayName,\n      walletProviderType: WalletProviderEnum.EmbeddedWallet,\n    });\n\n    if (!walletProviderMap.has(walletProviderKey)) {\n      const walletProvider = getWalletProviderByKey(\n        { walletProviderKey },\n        client\n      );\n\n      if (!walletProvider) {\n        throw new NoWalletProviderFoundError({\n          walletProviderKey,\n        });\n      }\n\n      if (!isWaasWalletProvider(walletProvider)) {\n        throw new NotWaasWalletProviderError({\n          walletProviderKey,\n        });\n      }\n\n      walletProviderMap.set(walletProviderKey, walletProvider);\n    }\n  }\n\n  await Promise.all(\n    filteredRequirements.map((requirement) => {\n      const walletProviderKey = formatWalletProviderKey({\n        chain: requirement.chain,\n        displayName: DYNAMIC_WAAS_METADATA.displayName,\n        walletProviderType: WalletProviderEnum.EmbeddedWallet,\n      });\n\n      const walletProvider = walletProviderMap.get(walletProviderKey);\n\n      if (!walletProvider || !isWaasWalletProvider(walletProvider)) {\n        return Promise.resolve();\n      }\n\n      return walletProvider.createWalletAccount({\n        bitcoinConfig: requirement.bitcoinConfig,\n        password,\n        thresholdSignatureScheme,\n      });\n    })\n  );\n\n  await refreshAuth(client);\n};\n","import { getDefaultClient } from '../../../client/defaultClient';\nimport { refreshAuth } from '../../user/refreshAuth';\nimport type { WalletAccount } from '../../wallets/walletAccount';\nimport { getWaasWalletProviderFromWalletAccount } from '../getWaasWalletProviderFromWalletAccount';\n\ntype DelegateWaasKeySharesParams = {\n  password?: string;\n  walletAccount: WalletAccount;\n};\n\n/**\n * Delegates cryptographic key shares for a WaaS wallet account.\n *\n * This function allows the delegation of key management responsibilities,\n * enabling distributed key management for enhanced security.\n *\n * @param params.walletAccount - The WaaS wallet account to delegate shares for.\n * @param [params.password] - Optional password for key share operations.\n * @param [client] - The Dynamic client instance. Only required when using multiple Dynamic clients.\n * @returns A promise that resolves when the key delegation is complete.\n */\nexport const delegateWaasKeyShares = async (\n  { password, walletAccount }: DelegateWaasKeySharesParams,\n  client = getDefaultClient()\n): Promise<void> => {\n  const provider = getWaasWalletProviderFromWalletAccount(\n    { walletAccount },\n    client\n  );\n\n  await provider.delegateKeyShares({\n    password,\n    walletAccount,\n  });\n\n  await refreshAuth(client);\n};\n","import { getDefaultClient } from '../../../client/defaultClient';\nimport type { WalletAccount } from '../../wallets/walletAccount';\nimport { getWaasWalletProviderFromWalletAccount } from '../getWaasWalletProviderFromWalletAccount';\n\ntype ExportWaasClientKeysharesParams = {\n  password?: string;\n  walletAccount: WalletAccount;\n};\n\n/**\n * Exports the client-side key shares for a WaaS wallet account.\n *\n * This function retrieves the cryptographic key shares that are stored\n * on the client side for backup or migration purposes.\n *\n * @param params.walletAccount - The WaaS wallet account to export shares from.\n * @param [params.password] - Optional password to encrypt the exported shares.\n * @param [client] - The Dynamic client instance. Only required when using multiple Dynamic clients.\n * @returns A promise that resolves to the exported key shares.\n */\nexport const exportWaasClientKeyshares = async (\n  { password, walletAccount }: ExportWaasClientKeysharesParams,\n  client = getDefaultClient()\n) => {\n  const provider = getWaasWalletProviderFromWalletAccount(\n    { walletAccount },\n    client\n  );\n\n  return provider.exportClientKeyshares({\n    password,\n    walletAccount,\n  });\n};\n","import { getDefaultClient } from '../../../client/defaultClient';\nimport type { WalletAccount } from '../../wallets/walletAccount';\nimport { getWaasWalletProviderFromWalletAccount } from '../getWaasWalletProviderFromWalletAccount';\n\ntype ExportWaasPrivateKeyParams = {\n  displayContainer: HTMLElement;\n  password?: string;\n  walletAccount: WalletAccount;\n};\n\n/**\n * Exports the private key for a WaaS wallet account with secure display.\n *\n * This function reveals the private key for a WaaS wallet and displays it\n * securely within an iframe dynamically inserted into the specified HTML container element.\n *\n * @param params.walletAccount - The WaaS wallet account to export the private key from.\n * @param params.displayContainer - The HTML element where the iframe will be injected.\n * @param [params.password] - Optional password to decrypt the private key.\n * @param [client] - The Dynamic client instance. Only required when using multiple Dynamic clients.\n * @returns A promise that resolves when the private key export is complete.\n */\nexport const exportWaasPrivateKey = async (\n  { displayContainer, password, walletAccount }: ExportWaasPrivateKeyParams,\n  client = getDefaultClient()\n) => {\n  const provider = getWaasWalletProviderFromWalletAccount(\n    { walletAccount },\n    client\n  );\n\n  return provider.exportPrivateKey({\n    displayContainer,\n    password,\n    walletAccount,\n  });\n};\n","import { type SdkUser, WalletProviderEnum } from '@dynamic-labs/sdk-api-core';\n\nimport { getChainFromVerifiedCredentialChain } from '../../../utils/getChainFromVerifiedCredentialChain';\nimport type { Chain } from '../../chain/chain.types';\n\ntype UserHasEmbeddedWalletForChainProps = {\n  chain: Chain;\n  user: SdkUser;\n};\n\nexport const userHasEmbeddedWalletForChain = ({\n  user,\n  chain,\n}: UserHasEmbeddedWalletForChainProps): boolean => {\n  const hasEmbeddedWalletForChain = user.verifiedCredentials.some(\n    (vc) =>\n      vc.walletProvider === WalletProviderEnum.EmbeddedWallet &&\n      vc.chain &&\n      getChainFromVerifiedCredentialChain(vc.chain) === chain\n  );\n\n  return hasEmbeddedWalletForChain;\n};\n","import { EmbeddedWalletVersionEnum } from '@dynamic-labs/sdk-api-core';\n\nimport { getDefaultClient } from '../../../client/defaultClient';\nimport { assertDefined } from '../../../utils/assertDefined';\n\n/**\n * Checks if Dynamic WaaS (Wallet as a Service) is enabled for the current project.\n *\n * This function examines the project settings to determine if Dynamic WaaS is\n * enabled in the Dynamic Dashboard or not.\n *\n * @param [client] - The Dynamic client instance. Only required when using multiple Dynamic clients.\n * @returns True if Dynamic WaaS is enabled, false otherwise.\n */\nexport const isDynamicWaasEnabled = (client = getDefaultClient()) => {\n  const projectSettings = client.projectSettings;\n\n  assertDefined(projectSettings, 'Project settings are not available');\n\n  const embeddedWalletSettings = projectSettings.sdk.embeddedWallets;\n\n  const dynamicWaasIsEnabled =\n    embeddedWalletSettings?.defaultWalletVersion ===\n    EmbeddedWalletVersionEnum.V3;\n\n  return dynamicWaasIsEnabled;\n};\n","import { getDefaultClient } from '../../../client/defaultClient';\nimport { assertDefined } from '../../../utils/assertDefined';\nimport type { Chain } from '../../chain/chain.types';\nimport { userHasEmbeddedWalletForChain } from '../../wallets/userHasEmbeddedWalletForChain';\nimport { isDynamicWaasEnabled } from '../isDynamicWaasEnabled';\n\n/**\n * Gets all chains missing a waas wallet account for the current user.\n *\n * @param [client] - The Dynamic client instance. Only required when using multiple Dynamic clients.\n * @returns An array of all chains that have waas wallet accounts enabled\n * but for which the current user does not yet have an embedded wallet account.\n */\nexport const getChainsMissingWaasWalletAccounts = (\n  client = getDefaultClient()\n): Chain[] => {\n  const projectSettings = client.projectSettings;\n\n  assertDefined(projectSettings, 'Project settings are not available');\n\n  const embeddedWalletSettings = projectSettings.sdk.embeddedWallets;\n\n  const isWaasEnabled = isDynamicWaasEnabled(client);\n\n  const user = client.user;\n\n  if (!user || !isWaasEnabled) {\n    return [];\n  }\n\n  const enabledChainForWaas: Chain[] = (\n    embeddedWalletSettings?.chainConfigurations?.filter(\n      (chain) => chain.enabled\n    ) ?? []\n  ).map((chain) => chain.name as Chain);\n\n  // For each enabled chain, if user does NOT have an embedded wallet, add to missing\n  return enabledChainForWaas.filter(\n    (chain) => !userHasEmbeddedWalletForChain({ chain, user })\n  );\n};\n","import { getDefaultClient } from '../../../client/defaultClient';\nimport { assertDefined } from '../../../utils/assertDefined';\nimport { getVerifiedCredentialForWalletAccount } from '../../wallets/utils/getVerifiedCredentialForWalletAccount';\nimport type { WalletAccount } from '../../wallets/walletAccount';\n\ntype HasDelegatedAccessParams = {\n  walletAccount: WalletAccount;\n};\n\n/**\n * Checks if a WaaS wallet account has delegated access.\n *\n * @param params.walletAccount - The WaaS wallet account to check for delegated access.\n * @param [client] - The Dynamic client instance. Only required when using multiple Dynamic clients.\n * @returns True if the wallet account has delegated access, false otherwise.\n */\nexport const hasDelegatedAccess = (\n  { walletAccount }: HasDelegatedAccessParams,\n  client = getDefaultClient()\n): boolean => {\n  const verifiedCredential = getVerifiedCredentialForWalletAccount(\n    { walletAccount },\n    client\n  );\n\n  assertDefined(\n    verifiedCredential,\n    'Verified credential not found for Waas wallet account'\n  );\n\n  const hasDelegatedKeyShare =\n    verifiedCredential.walletProperties?.keyShares?.some(\n      (keyShare) => keyShare.backupLocation === 'delegated'\n    );\n\n  return !!hasDelegatedKeyShare;\n};\n","import { WalletProviderEnum } from '@dynamic-labs/sdk-api-core';\n\nimport type { DynamicClient } from '../../../client/types/DynamicClient';\nimport { NoWalletProviderFoundError } from '../../../errors/NoWalletProviderFoundError';\nimport type { Chain } from '../../chain';\nimport { formatWalletProviderKey } from '../../wallets/utils/formatWalletProviderKey';\nimport { DYNAMIC_WAAS_METADATA } from '../constants';\nimport type { WaasWalletProvider } from '../waas.types';\nimport { findWaasWalletProviderByChain } from '../findWaasWalletProviderByChain/findWaasWalletProviderByChain';\n\ntype GetWaasWalletProviderByChainParams = {\n  chain: Chain;\n};\n\nexport const getWaasWalletProviderByChain = (\n  { chain }: GetWaasWalletProviderByChainParams,\n  client: DynamicClient\n): WaasWalletProvider => {\n  const waasProvider = findWaasWalletProviderByChain({ chain }, client);\n\n  if (!waasProvider) {\n    const waasProviderKey = formatWalletProviderKey({\n      chain,\n      displayName: DYNAMIC_WAAS_METADATA.displayName,\n      walletProviderType: WalletProviderEnum.EmbeddedWallet,\n    });\n\n    throw new NoWalletProviderFoundError({\n      walletProviderKey: waasProviderKey,\n    });\n  }\n\n  return waasProvider;\n};\n","import type { ThresholdSignatureScheme } from '@dynamic-labs-wallet/browser-wallet-client';\n\nimport { getDefaultClient } from '../../../client/defaultClient';\nimport type { Chain } from '../../chain';\nimport { getWaasWalletProviderByChain } from '../getWaasWalletProviderByChain';\n\ntype ImportWaasPrivateKeyParams = {\n  chain: Chain;\n  privateKey: string;\n  thresholdSignatureScheme?: ThresholdSignatureScheme;\n};\n\n/**\n * Imports an existing private key to create a new WaaS wallet account.\n *\n * This function allows users to import their existing private key into\n * Dynamic's WaaS infrastructure for secure management.\n *\n * @param params.chain - The chain for the imported wallet.\n * @param params.privateKey - The private key to import.\n * @param [params.thresholdSignatureScheme] - Optional threshold signature scheme configuration. Default is TWO_OF_TWO.\n * @param [client] - The Dynamic client instance. Only required when using multiple Dynamic clients.\n * @returns A promise that resolves when the private key is successfully imported.\n */\nexport const importWaasPrivateKey = async (\n  { chain, privateKey, thresholdSignatureScheme }: ImportWaasPrivateKeyParams,\n  client = getDefaultClient()\n) => {\n  const provider = getWaasWalletProviderByChain({ chain }, client);\n\n  return provider.importPrivateKey({\n    privateKey,\n    thresholdSignatureScheme,\n  });\n};\n","import { getDefaultClient } from '../../../client/defaultClient';\nimport { assertDefined } from '../../../utils/assertDefined';\n\n/**\n * Checks if the user Waas wallets are password protected.\n *\n * If the user's Waas wallets are password protected, it means that user's will have to be prompted for a\n * password for the first wallet action that happens on each session.\n * The password is also required for creating any new Waas wallets.\n *\n * @param client - The Dynamic client instance. Only required when using multiple Dynamic clients.\n * @returns True if the user has any password protected Waas wallets, false otherwise\n */\nexport const isPasswordRequiredForWaasWallets = (\n  client = getDefaultClient()\n): boolean => {\n  const { user } = client;\n\n  assertDefined(user, 'User is not authenticated');\n\n  return user.verifiedCredentials.some((credential) =>\n    credential.walletProperties?.keyShares?.some(\n      (keyShare) => keyShare.passwordEncrypted\n    )\n  );\n};\n","import { getDefaultClient } from '../../../client/defaultClient';\nimport type { WalletAccount } from '../../wallets/walletAccount';\nimport { getWaasWalletProviderFromWalletAccount } from '../getWaasWalletProviderFromWalletAccount';\n\ntype RefreshWaasWalletAccountSharesParams = {\n  password?: string;\n  walletAccount: WalletAccount;\n};\n\n/**\n * Refreshes the cryptographic key shares for a WaaS wallet account.\n *\n * This function generates new key shares for the wallet while maintaining\n * the same threshold signature scheme.\n *\n * @param params.walletAccount - The WaaS wallet account to refresh shares for.\n * @param [params.password] - Optional password for key share operations.\n * @param [client] - The Dynamic client instance. Only required when using multiple Dynamic clients.\n * @returns A promise that resolves when the key shares are refreshed.\n */\nexport const refreshWaasWalletAccountShares = async (\n  { walletAccount, password }: RefreshWaasWalletAccountSharesParams,\n  client = getDefaultClient()\n) => {\n  const provider = getWaasWalletProviderFromWalletAccount(\n    { walletAccount },\n    client\n  );\n\n  return provider.refreshWalletAccountShares({\n    password,\n    walletAccount,\n  });\n};\n","import { getDefaultClient } from '../../../client/defaultClient';\nimport { refreshAuth } from '../../user/refreshAuth';\nimport type { WalletAccount } from '../../wallets/walletAccount';\nimport { getWaasWalletProviderFromWalletAccount } from '../getWaasWalletProviderFromWalletAccount';\n\ntype RevokeWaasDelegationParams = {\n  password?: string;\n  walletAccount: WalletAccount;\n};\n\n/**\n * Revokes the delegation of a WaaS wallet account.\n *\n * @param params.walletAccount - The WaaS wallet account to revoke delegation for.\n * @param [params.password] - Optional password for delegation operations.\n * @param [client] - The Dynamic client instance. Only required when using multiple Dynamic clients.\n * @returns A promise that resolves when the delegation is revoked.\n */\nexport const revokeWaasDelegation = async (\n  { password, walletAccount }: RevokeWaasDelegationParams,\n  client = getDefaultClient()\n): Promise<void> => {\n  const provider = getWaasWalletProviderFromWalletAccount(\n    { walletAccount },\n    client\n  );\n\n  await provider.revokeDelegation({\n    password,\n    walletAccount,\n  });\n\n  await refreshAuth(client);\n};\n","import {\n  JwtVerifiedCredentialFormatEnum,\n  type SdkUser,\n  WalletProviderEnum,\n} from '@dynamic-labs/sdk-api-core';\n\nexport const userHasExternalWallet = (user: SdkUser) => {\n  const hasExternalWallet = user?.verifiedCredentials.some(\n    (vc) =>\n      vc.format === JwtVerifiedCredentialFormatEnum.Blockchain &&\n      vc.walletProvider !== WalletProviderEnum.EmbeddedWallet\n  );\n\n  return hasExternalWallet;\n};\n","import { getDefaultClient } from '../../../client/defaultClient';\nimport { assertDefined } from '../../../utils/assertDefined';\nimport type { Chain } from '../../chain';\nimport { userHasExternalWallet } from '../../wallets/userHasExternalWallet';\nimport { getChainsMissingWaasWalletAccounts } from '../getChainsMissingWaasWalletAccounts';\n\ntype ShouldAutoCreateWalletForChainParams = {\n  chain: Chain;\n};\n\n/**\n * Checks if a WaaS wallet should be automatically created for the specified blockchain.\n *\n * This function determines whether the current user configuration and project\n * settings require automatic wallet creation for the given chain, considering\n * whether the user already has an embedded wallet for the enabled chains or an external wallet.\n *\n * @param params.chain - The blockchain network to check.\n * @param [client] - The Dynamic client instance. Only required when using multiple Dynamic clients.\n * @returns True if a wallet should be auto-created for the chain, false otherwise.\n */\nexport const shouldAutoCreateWalletForChain = (\n  { chain }: ShouldAutoCreateWalletForChainParams,\n  client = getDefaultClient()\n) => {\n  assertDefined(client.projectSettings, 'Project settings are not available');\n\n  const embeddedWalletSettings = client.projectSettings.sdk.embeddedWallets;\n\n  const automaticEmbeddedWalletCreationEnabled =\n    embeddedWalletSettings?.automaticEmbeddedWalletCreation;\n\n  if (!automaticEmbeddedWalletCreationEnabled || !client.user) {\n    return false;\n  }\n\n  const automaticEmbeddedWalletCreationForExternalEnabled =\n    embeddedWalletSettings?.automaticEmbeddedWalletCreationForExternal;\n\n  // If user has an external wallet (e.g metamask, phantom, etc), should only\n  // create if automaticEmbeddedWalletCreationForExternalEnabled is true\n  const shouldCreateDynamicWaasWallet =\n    !userHasExternalWallet(client.user) ||\n    automaticEmbeddedWalletCreationForExternalEnabled;\n\n  if (!shouldCreateDynamicWaasWallet) {\n    return false;\n  }\n\n  const chainsMissingAutoCreatedWallet =\n    getChainsMissingWaasWalletAccounts(client);\n\n  return chainsMissingAutoCreatedWallet.includes(chain);\n};\n","import { getDefaultClient } from '../../../client/defaultClient';\nimport type { WalletAccount } from '../../wallets/walletAccount';\nimport { getWaasWalletProviderFromWalletAccount } from '../getWaasWalletProviderFromWalletAccount';\n\ntype UpdateWaasPasswordParams = {\n  currentPassword: string;\n  newPassword: string;\n  walletAccount: WalletAccount;\n};\n\n/**\n * Updates the password for a WaaS wallet account.\n *\n * This function changes the password used to encrypt and protect the\n * cryptographic key shares for the specified wallet account.\n *\n * @param params.walletAccount - The WaaS wallet account to update the password for.\n * @param params.currentPassword - The current password for the wallet.\n * @param params.newPassword - The new password to set for the wallet.\n * @param [client] - The Dynamic client instance. Only required when using multiple Dynamic clients.\n * @returns A promise that resolves when the password is successfully updated.\n */\nexport const updateWaasPassword = async (\n  { currentPassword, newPassword, walletAccount }: UpdateWaasPasswordParams,\n  client = getDefaultClient()\n) => {\n  const provider = getWaasWalletProviderFromWalletAccount(\n    { walletAccount },\n    client\n  );\n\n  return provider.updatePassword({\n    currentPassword,\n    newPassword,\n    walletAccount,\n  });\n};\n","import { assertPackageVersion } from '@dynamic-labs-sdk/assert-package-version';\n\nimport {\n  name as packageName,\n  version as packageVersion,\n} from '../../package.json';\nassertPackageVersion(packageName, packageVersion);\n\nexport { NotWaasWalletProviderError } from '../errors/NotWaasWalletProviderError';\nexport { backupWaasKeySharesToGoogleDrive } from '../modules/waas/backupWaasKeySharesToGoogleDrive';\nexport { createWaasWalletAccounts } from '../modules/waas/createWaasWalletAccounts';\nexport { delegateWaasKeyShares } from '../modules/waas/delegateWaasKeyShares';\nexport { exportWaasClientKeyshares } from '../modules/waas/exportWaasClientKeyshares';\nexport { exportWaasPrivateKey } from '../modules/waas/exportWaasPrivateKey';\nexport { getChainsMissingWaasWalletAccounts } from '../modules/waas/getChainsMissingWaasWalletAccounts';\nexport { hasDelegatedAccess } from '../modules/waas/hasDelegatedAccess';\nexport { importWaasPrivateKey } from '../modules/waas/importWaasPrivateKey';\nexport { isDynamicWaasEnabled } from '../modules/waas/isDynamicWaasEnabled';\nexport { isPasswordRequiredForWaasWallets } from '../modules/waas/isPasswordRequiredForWaasWallets';\nexport { isWalletCreationRequirement } from '../modules/waas/isWalletCreationRequirement/isWalletCreationRequirement';\nexport { normalizeWalletRequirements } from '../modules/waas/normalizeWalletRequirements/normalizeWalletRequirements';\nexport { isWaasWalletAccount } from '../modules/waas/isWaasWalletAccount';\nexport { refreshWaasWalletAccountShares } from '../modules/waas/refreshWaasWalletAccountShares';\nexport { revokeWaasDelegation } from '../modules/waas/revokeWaasDelegation';\nexport { shouldAutoCreateWalletForChain } from '../modules/waas/shouldAutoCreateWalletForChain';\nexport { updateWaasPassword } from '../modules/waas/updateWaasPassword';\nexport type {\n  WalletCreationBitcoinConfig,\n  WalletCreationRequirement,\n} from '../modules/waas/waas.types';\n"],"mappings":"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"}