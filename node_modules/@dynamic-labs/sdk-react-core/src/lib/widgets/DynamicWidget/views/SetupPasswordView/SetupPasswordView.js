'use client'
import { jsx } from 'react/jsx-runtime';
import { useState, useCallback } from 'react';
import { useWidgetContext } from '../../context/DynamicWidgetContext.js';
import { SetupPasswordConfirmView } from '../SetupPasswordConfirmView/SetupPasswordConfirmView.js';
import { SetupPasswordEnterView } from '../SetupPasswordEnterView/SetupPasswordEnterView.js';
import '../../../../../../_virtual/_tslib.js';
import '@dynamic-labs/utils';
import '@dynamic-labs/iconic';
import '../../../../context/ViewContext/ViewContext.js';
import { SetupPasswordKnowledgeCheckView } from '../SetupPasswordKnowledgeCheckView/SetupPasswordKnowledgeCheckView.js';
import { SetupPasswordSuccessView } from '../SetupPasswordSuccessView/SetupPasswordSuccessView.js';
import { SetupPasswordTermsView } from '../SetupPasswordTermsView/SetupPasswordTermsView.js';

const SetupPasswordView = ({ onComplete, onCancel, skipKnowledgeCheck = false, }) => {
    const { setDynamicWidgetView, setIsOpen } = useWidgetContext();
    const [currentStep, setCurrentStep] = useState('terms');
    const [password, setPassword] = useState('');
    const goToAccountAndSecurity = useCallback(() => {
        setDynamicWidgetView('account-and-security-settings');
    }, [setDynamicWidgetView]);
    const handleCancel = useCallback(() => {
        if (onCancel) {
            onCancel();
        }
        else {
            goToAccountAndSecurity();
        }
    }, [onCancel, goToAccountAndSecurity]);
    const handleTermsContinue = useCallback(() => {
        setCurrentStep('enter');
    }, []);
    const handleEnterContinue = useCallback((newPassword) => {
        setPassword(newPassword);
        setCurrentStep('confirm');
    }, []);
    const handleEnterBack = useCallback(() => {
        setCurrentStep('terms');
    }, []);
    const handleConfirmContinue = useCallback(() => {
        if (skipKnowledgeCheck) {
            setCurrentStep('success');
        }
        else {
            setCurrentStep('knowledge-check');
        }
    }, [skipKnowledgeCheck]);
    const handleConfirmBack = useCallback(() => {
        setCurrentStep('enter');
    }, []);
    const handleKnowledgeCheckContinue = useCallback(() => {
        setCurrentStep('success');
    }, []);
    const handleKnowledgeCheckBack = useCallback(() => {
        setCurrentStep('confirm');
    }, []);
    const goToWallets = useCallback(() => {
        setDynamicWidgetView('wallets');
    }, [setDynamicWidgetView]);
    const handleSuccess = useCallback(() => {
        onComplete(password);
        // Navigate to appropriate view based on where we came from:
        // - If onCancel was provided (auto-create flow), go to wallets then close widget
        // - If onCancel wasn't provided (settings flow), go to account settings
        if (onCancel) {
            goToWallets();
            setIsOpen(false);
        }
        else {
            goToAccountAndSecurity();
        }
    }, [
        onComplete,
        password,
        onCancel,
        goToAccountAndSecurity,
        goToWallets,
        setIsOpen,
    ]);
    switch (currentStep) {
        case 'terms':
            return (jsx(SetupPasswordTermsView, { onContinue: handleTermsContinue, onBack: onCancel ? undefined : handleCancel }));
        case 'enter':
            return (jsx(SetupPasswordEnterView, { onContinue: handleEnterContinue, onBack: handleEnterBack }));
        case 'confirm':
            return (jsx(SetupPasswordConfirmView, { password: password, onContinue: handleConfirmContinue, onBack: handleConfirmBack }));
        case 'knowledge-check':
            return (jsx(SetupPasswordKnowledgeCheckView, { onContinue: handleKnowledgeCheckContinue, onBack: handleKnowledgeCheckBack }));
        case 'success':
            return jsx(SetupPasswordSuccessView, { onDone: handleSuccess });
        default:
            return null;
    }
};

export { SetupPasswordView };
