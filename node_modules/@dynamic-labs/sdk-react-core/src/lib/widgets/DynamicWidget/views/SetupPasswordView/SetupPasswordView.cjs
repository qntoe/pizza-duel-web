'use client'
'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var jsxRuntime = require('react/jsx-runtime');
var React = require('react');
var DynamicWidgetContext = require('../../context/DynamicWidgetContext.cjs');
var SetupPasswordConfirmView = require('../SetupPasswordConfirmView/SetupPasswordConfirmView.cjs');
var SetupPasswordEnterView = require('../SetupPasswordEnterView/SetupPasswordEnterView.cjs');
require('../../../../../../_virtual/_tslib.cjs');
require('@dynamic-labs/utils');
require('@dynamic-labs/iconic');
require('../../../../context/ViewContext/ViewContext.cjs');
var SetupPasswordKnowledgeCheckView = require('../SetupPasswordKnowledgeCheckView/SetupPasswordKnowledgeCheckView.cjs');
var SetupPasswordSuccessView = require('../SetupPasswordSuccessView/SetupPasswordSuccessView.cjs');
var SetupPasswordTermsView = require('../SetupPasswordTermsView/SetupPasswordTermsView.cjs');

const SetupPasswordView = ({ onComplete, onCancel, skipKnowledgeCheck = false, }) => {
    const { setDynamicWidgetView, setIsOpen } = DynamicWidgetContext.useWidgetContext();
    const [currentStep, setCurrentStep] = React.useState('terms');
    const [password, setPassword] = React.useState('');
    const goToAccountAndSecurity = React.useCallback(() => {
        setDynamicWidgetView('account-and-security-settings');
    }, [setDynamicWidgetView]);
    const handleCancel = React.useCallback(() => {
        if (onCancel) {
            onCancel();
        }
        else {
            goToAccountAndSecurity();
        }
    }, [onCancel, goToAccountAndSecurity]);
    const handleTermsContinue = React.useCallback(() => {
        setCurrentStep('enter');
    }, []);
    const handleEnterContinue = React.useCallback((newPassword) => {
        setPassword(newPassword);
        setCurrentStep('confirm');
    }, []);
    const handleEnterBack = React.useCallback(() => {
        setCurrentStep('terms');
    }, []);
    const handleConfirmContinue = React.useCallback(() => {
        if (skipKnowledgeCheck) {
            setCurrentStep('success');
        }
        else {
            setCurrentStep('knowledge-check');
        }
    }, [skipKnowledgeCheck]);
    const handleConfirmBack = React.useCallback(() => {
        setCurrentStep('enter');
    }, []);
    const handleKnowledgeCheckContinue = React.useCallback(() => {
        setCurrentStep('success');
    }, []);
    const handleKnowledgeCheckBack = React.useCallback(() => {
        setCurrentStep('confirm');
    }, []);
    const goToWallets = React.useCallback(() => {
        setDynamicWidgetView('wallets');
    }, [setDynamicWidgetView]);
    const handleSuccess = React.useCallback(() => {
        onComplete(password);
        // Navigate to appropriate view based on where we came from:
        // - If onCancel was provided (auto-create flow), go to wallets then close widget
        // - If onCancel wasn't provided (settings flow), go to account settings
        if (onCancel) {
            goToWallets();
            setIsOpen(false);
        }
        else {
            goToAccountAndSecurity();
        }
    }, [
        onComplete,
        password,
        onCancel,
        goToAccountAndSecurity,
        goToWallets,
        setIsOpen,
    ]);
    switch (currentStep) {
        case 'terms':
            return (jsxRuntime.jsx(SetupPasswordTermsView.SetupPasswordTermsView, { onContinue: handleTermsContinue, onBack: onCancel ? undefined : handleCancel }));
        case 'enter':
            return (jsxRuntime.jsx(SetupPasswordEnterView.SetupPasswordEnterView, { onContinue: handleEnterContinue, onBack: handleEnterBack }));
        case 'confirm':
            return (jsxRuntime.jsx(SetupPasswordConfirmView.SetupPasswordConfirmView, { password: password, onContinue: handleConfirmContinue, onBack: handleConfirmBack }));
        case 'knowledge-check':
            return (jsxRuntime.jsx(SetupPasswordKnowledgeCheckView.SetupPasswordKnowledgeCheckView, { onContinue: handleKnowledgeCheckContinue, onBack: handleKnowledgeCheckBack }));
        case 'success':
            return jsxRuntime.jsx(SetupPasswordSuccessView.SetupPasswordSuccessView, { onDone: handleSuccess });
        default:
            return null;
    }
};

exports.SetupPasswordView = SetupPasswordView;
