'use client'
import { __awaiter } from '../../_virtual/_tslib.js';
import { walletConnectorEvents } from '@dynamic-labs/wallet-connector-core';
import { Logger } from '@dynamic-labs/logger';
import { FreighterWalletConnector } from '../connectors/FreighterWalletConnector/FreighterWalletConnector.js';
import { LobstrWalletConnector } from '../connectors/LobstrWalletConnector/LobstrWalletConnector.js';
import { OneKeyWalletConnector } from '../connectors/OneKeyWalletConnector/OneKeyWalletConnector.js';

const logger = new Logger('fetchInjectedWalletConnectors');
const initialStellarWalletConnectors = [LobstrWalletConnector, FreighterWalletConnector, OneKeyWalletConnector];
const stellarWalletConnectors = [
    ...initialStellarWalletConnectors,
];
const checkAndEmitWalletConnector = (walletConnector) => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    try {
        yield ((_a = walletConnector.isConnected) === null || _a === void 0 ? void 0 : _a.call(walletConnector));
        return walletConnector;
    }
    catch (error) {
        logger.logVerboseTroubleshootingMessage(`[STELLAR fetchInjectedWalletConnectors] Error checking ${walletConnector.name}:`, error);
    }
    return undefined;
});
const setupStellarWalletListener = () => {
    if (typeof window === 'undefined') {
        return;
    }
    const discoveredWallets = new Set();
    const checkForNewWallets = () => __awaiter(void 0, void 0, void 0, function* () {
        for (const walletConnector of stellarWalletConnectors) {
            if (discoveredWallets.has(walletConnector.name)) {
                continue;
            }
            const connector = yield checkAndEmitWalletConnector(walletConnector);
            if (connector) {
                discoveredWallets.add(walletConnector.name);
                logger.logVerboseTroubleshootingMessage(`[STELLAR fetchInjectedWalletConnectors] Emitting providerInjected for ${walletConnector.name}`);
                walletConnectorEvents.emit('providerInjected', {
                    injectedConnectorConstructor: connector,
                });
            }
        }
    });
    void checkForNewWallets();
};
const fetchInjectedWalletConnectors = () => {
    setupStellarWalletListener();
    return [...stellarWalletConnectors];
};

export { fetchInjectedWalletConnectors };
