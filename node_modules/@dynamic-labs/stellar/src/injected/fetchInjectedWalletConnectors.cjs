'use client'
'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var _tslib = require('../../_virtual/_tslib.cjs');
var walletConnectorCore = require('@dynamic-labs/wallet-connector-core');
var logger$1 = require('@dynamic-labs/logger');
var FreighterWalletConnector = require('../connectors/FreighterWalletConnector/FreighterWalletConnector.cjs');
var LobstrWalletConnector = require('../connectors/LobstrWalletConnector/LobstrWalletConnector.cjs');
var OneKeyWalletConnector = require('../connectors/OneKeyWalletConnector/OneKeyWalletConnector.cjs');

const logger = new logger$1.Logger('fetchInjectedWalletConnectors');
const initialStellarWalletConnectors = [LobstrWalletConnector.LobstrWalletConnector, FreighterWalletConnector.FreighterWalletConnector, OneKeyWalletConnector.OneKeyWalletConnector];
const stellarWalletConnectors = [
    ...initialStellarWalletConnectors,
];
const checkAndEmitWalletConnector = (walletConnector) => _tslib.__awaiter(void 0, void 0, void 0, function* () {
    var _a;
    try {
        yield ((_a = walletConnector.isConnected) === null || _a === void 0 ? void 0 : _a.call(walletConnector));
        return walletConnector;
    }
    catch (error) {
        logger.logVerboseTroubleshootingMessage(`[STELLAR fetchInjectedWalletConnectors] Error checking ${walletConnector.name}:`, error);
    }
    return undefined;
});
const setupStellarWalletListener = () => {
    if (typeof window === 'undefined') {
        return;
    }
    const discoveredWallets = new Set();
    const checkForNewWallets = () => _tslib.__awaiter(void 0, void 0, void 0, function* () {
        for (const walletConnector of stellarWalletConnectors) {
            if (discoveredWallets.has(walletConnector.name)) {
                continue;
            }
            const connector = yield checkAndEmitWalletConnector(walletConnector);
            if (connector) {
                discoveredWallets.add(walletConnector.name);
                logger.logVerboseTroubleshootingMessage(`[STELLAR fetchInjectedWalletConnectors] Emitting providerInjected for ${walletConnector.name}`);
                walletConnectorCore.walletConnectorEvents.emit('providerInjected', {
                    injectedConnectorConstructor: connector,
                });
            }
        }
    });
    void checkForNewWallets();
};
const fetchInjectedWalletConnectors = () => {
    setupStellarWalletListener();
    return [...stellarWalletConnectors];
};

exports.fetchInjectedWalletConnectors = fetchInjectedWalletConnectors;
