!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.lobstrExtensionApi=n():e.lobstrExtensionApi=n()}(this,()=>(()=>{"use strict";var e={d:(n,o)=>{for(var t in o)e.o(o,t)&&!e.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:o[t]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},n={};e.r(n),e.d(n,{default:()=>u,getPublicKey:()=>a,isBrowser:()=>S,isConnected:()=>c,signMessage:()=>l,signTransaction:()=>d});let o=function(e){return e[e.V1=0]="V1",e[e.V2=1]="V2",e}({}),t=function(e){return e.REQUEST_ACCESS="REQUEST_ACCESS",e.SIGN="SIGN",e.SUBMIT_TRANSACTION="SUBMIT_TRANSACTION",e.SIGN_TRANSACTION="SIGN_TRANSACTION",e.REQUEST_CONNECTION_STATUS="REQUEST_CONNECTION_STATUS",e}({});const r="LOBSTR_CONNECTION_KEY",i=e=>{const n=Date.now()+Math.random();return window.postMessage({source:"LOBSTR_EXTERNAL_MSG_REQUEST",messageId:n,...e},window.location.origin),new Promise(o=>{let r=0;e.type===t.REQUEST_CONNECTION_STATUS&&(r=setTimeout(()=>{o({isConnected:!1}),window.removeEventListener("message",i)},2e3));const i=e=>{var t,s;e.source===window&&"LOBSTR_EXTERNAL_MSG_RESPONSE"===(null==e||null===(t=e.data)||void 0===t?void 0:t.source)&&(null==e||null===(s=e.data)||void 0===s?void 0:s.messagedId)===n&&(o(e.data),window.removeEventListener("message",i),clearTimeout(r))};window.addEventListener("message",i,!1)})},s=async(e,n,r)=>{let s={signedData:"",error:"",signerAddress:""};try{s=await i({dataToSign:e,connectionKey:n,signType:r,type:t.SIGN,version:o.V2})}catch(e){throw console.error(e),e}if(s.error)throw s.error;return s},a=async()=>{if(!S)return"";const{publicKey:e,connectionKey:n}=await(async()=>{let e={publicKey:"",error:"",connectionKey:""};try{e=await i({type:t.REQUEST_ACCESS,version:o.V2})}catch(e){console.error(e)}const{publicKey:n,connectionKey:r,error:s}=e;if(s)throw s;return{publicKey:n,connectionKey:r}})();return(e=>{var n,o;null===(n=window)||void 0===n||null===(o=n.sessionStorage)||void 0===o||o.setItem(r,e)})(n),e},d=async e=>{if(!S)return Promise.resolve("");const n=(null===(o=window)||void 0===o||null===(t=o.sessionStorage)||void 0===t?void 0:t.getItem(r))||"";var o,t;return(await s(e,n,"transaction")).signedData},c=async()=>!!S&&(window.lobstrSignerExtension?window.lobstrSignerExtension:await(async()=>{let e={isConnected:!1};try{e=await i({type:t.REQUEST_CONNECTION_STATUS,version:o.V2})}catch(e){console.error(e)}return e.isConnected})()),l=async e=>{if(!S)return Promise.resolve(null);const n=(null===(o=window)||void 0===o||null===(t=o.sessionStorage)||void 0===t?void 0:t.getItem(r))||"";var o,t;const i=await s(e,n,"message");return{signedMessage:i.signedData,signerAddress:i.signerAddress}},S="undefined"!=typeof window,u={getPublicKey:a,signTransaction:d,isConnected:c,signMessage:l};return n})());